<?xml version='1.0' encoding='utf-8'?>
<!--
  Dynamically generated by Chef on <%= node["fqdn"] %>
  Local modifications will be overwritten by Chef.
-->
<!-- Note:  A "Server" is not itself a "Container", so you may not
     define subcomponents such as "Valves" at this level.
     Documentation at /docs/config/server.html
 -->
<Server port="<%= node["tomcat"]["shutdown_port"] %>" shutdown="SHUTDOWN">
  
   <!--APR library loader. Documentation at /docs/apr.html -->
   <Listener className="org.apache.catalina.core.AprLifecycleListener" SSLEngine="on" />
   <!-- Prevent memory leaks due to use of particular java/javax APIs-->
   <Listener className="org.apache.catalina.core.JreMemoryLeakPreventionListener" />
   <Listener className="org.apache.catalina.mbeans.GlobalResourcesLifecycleListener" />
   <Listener className="org.apache.catalina.core.ThreadLocalLeakPreventionListener" />
   <Listener className="org.apache.catalina.mbeans.JmxRemoteLifecycleListener" rmiRegistryPortPlatform="1098" rmiServerPortPlatform="1099" />
  
   <GlobalNamingResources>
      <Resource name="UserDatabase" auth="Container" type="org.apache.catalina.UserDatabase"
                description="User database that can be updated and saved"
                factory="org.apache.catalina.users.MemoryUserDatabaseFactory"
                pathname="conf/tomcat-users.xml" />
   </GlobalNamingResources>
  
   <Service name="Catalina">
      <Connector protocol="org.apache.coyote.http11.Http11NioProtocol" port="8443" connectionTimeout="1000" disableUploadTimeout="true"
                 maxThreads="300" SSLEnabled="true" scheme="https" secure="true" minSpareThreads="150" maxHttpHeaderSize="65536" acceptCount="100"
                 backlog="100" URIEncoding="UTF-8" compression="on" compressionMinSize="2048" compressableMimeType="text/html,text/xml,application/xml,application/json"
                  SSLCertificateFile="/opt/tomcat/certs/certificate.crt" SSLCertificateKeyFile="/opt/tomcat/certs/certificate.key" clientAuth="false" sslProtocol="TLS"/>
  
      <Engine name="Catalina" defaultHost="localhost">
          <Realm className="org.apache.catalina.realm.UserDatabaseRealm" resourceName="UserDatabase" />
          <Host name="localhost" appBase="webapps" unpackWARs="<%= node["tomcat"]["unpack_wars"] %>" autoDeploy="true" />                  
      </Engine>
   </Service>
</Server>

